package <%= Env['java_package']%>;

import com.mdi.tools.std.BuffRef;

public class CookieJar {

  public static final String PROTOCOL_VERSION = <%= Env['protocol_version'] %>;
  public static final String PG_VERSION = "<%= ::ProtocolGenerator.version %>";

  public static class StoredCookie {
    public final BuffRef  content;
    public final BuffRef  signature;
    public final int      expiration;
    public                StoredCookie(BuffRef content_t, BuffRef signature_t, int expiration_t){
      content = content_t;
      signature = signature_t;
      expiration = expiration_t;
    }
  }
  <% Env['cookie_names'].each do |cookie_name| %>
  private static StoredCookie _<%= cookie_name.downcase %> = null;<% end %>
  <% Env['cookie_names'].each_with_index do |cookie_name, i| %>
  public static final int <%= cookie_name.upcase %>_ID = <%= i %>;<% end %>

  public static void set(int id, StoredCookie cookie) {
    switch(id){<% Env['cookie_names'].each do |cookie_name| %>
    case <%= cookie_name.upcase %>_ID:
      _<%= cookie_name.downcase %> = cookie;<% end %>
    }
  }

  public static StoredCookie get(int id) {
    switch(id){<% Env['cookie_names'].each do |cookie_name| %>
    case <%= cookie_name.upcase %>_ID:
      return _<%= cookie_name.downcase %>;<% end %>
    default:
      return null; // TODO: Throw exception
    }
  }

  public static boolean has(int id) {
    switch(id){<% Env['cookie_names'].each do |cookie_name| %>
    case <%= cookie_name.upcase %>_ID:
      return _<%= cookie_name.downcase %> != null;<% end %>
    default:
      return false;
    }
  }

  public static void clean() {
    int current_time = (int) (System.currentTimeMillis() / 1000L);<%

  Env['cookie_names'].each do |cookie_name| %>
    if (_<%= cookie_name.downcase %> != null && _<%= cookie_name.downcase %>.expiration < current_time) {
      _<%= cookie_name.downcase %> = null;
    }<% end %>
  }
}