Protocol Generator
==================

The MDI protocol generator, based on msgpack, aims to simplify the communication protocol between MDI devices and servers. It generates the base server and device code that will serialize/deserialize messages and deal with sequences (message A waits for a message B answer…)

## Dependencies

In order to make the protocol generator work, you will need the "jar" and "javac" java build tools installed on your system. It also needs the device core .jar. You can find it in config/mdi-framework-3.X.jar . If you wish to use your own lib, you can define it in your configuration file.

(deactivated) You will also need doxygen installed, if you wish to have documentation aside from generated code.

## Usage

To generate some code, you need to launch :

    ruby protogen.rb <protocol_file_path> <configuration_file_path>

where &lt;protocol_file_path&gt; is the path to the file which describes your protocol.
where &lt;configuration_file_path&gt; is the path to the file which will configure how your code will be generated.


## Protocol file

See doc/for_sdk_vm/Protocol_Generator.md to learn how to write a protocol file
## Configuration file

This files will decribe how the code will be generated. It can either be written by the user, if he wants to generate code on his own, or be generated by a specific platform (the SDK VM for example).

### Device configuration file

    {
      "plugins":  [
        "mdi_sdk_vm_device_java"
      ],
      "agent_name":"ProtogenAgentTest",
      "device_output_directory":"sdk_defined_directory",
      "java_package":"com.mdi.test.protogen.avril11", /* the name of the java package in which all the code will be generated*/
      "java_outer_classname":"MDIMessages", /* the name of the main generated class */
      "keep_java_source":false, /* whether the source files are included in the release */
      "keep_java_jar":true, /* whether the jar is included in the release */
      "mdi_framework_jar":"/home/guillaume/sdk/MDI-SDK-3.0.14-rc1-linux-x86_64/plugins/com.mdi.project.fw_3.0.13.20121016153400/mdi-framework-3.X/simulator/mdi-framework-3.X.jar", /* path to the mdi framework. Used only when compiling java during code generation and to override default framework in config*/
      "check_protocol_version":"yes" /* optional */
    }

### Server configuration file

    {
      "plugins":  [
        "mdi_sdk_vm_server_ruby"
      ],
      "agent_name":"ProtogenAgentTest",
      "server_output_directory":"sdk_defined_directory",
      "check_protocol_version":"yes" /* optional */
    }

## How messages are formated

Each message, once serialized, share the same structure :


    { /* messagewrap */
      "type":1, /* int, id of the message. */
      "msg":{
        "surname":"John",
        "name":"Malkovich",
        "age":59,
        …
      },
      "_cookieA":{
        "expiration":123456789, /* int, timestamp of the expiration date of the cookie */
        "content":"3NcRYP73D57UfF" /* encrypted content */
        "sig":"516n47uR3" /* signature */
      },
      "_cookieB":{
        …
      },
      …
    }


## Tests

To launch the protogen tests, you simply have to launch the test.rb script at the root of the protogen. Be sure that the sdk vm is up, and that you have released the same version of the protogen on the vm (using for example "./release_sdk.rb -l").
